# 堤坝安全分析流水线

基于电-地质力学监测信号的大坝安全评估综合分析框架

## 概述

本流水线通过四个分析步骤处理大坝监测数据：数据处理、相关性分析、模型对比和气候影响评估。该框架展示了结合自然电位和耦合电场测量预测大坝稳定性系数的有效性。

## 项目结构

```

├── config.py                      # 集中配置文件
├── main.py                        # 主控制程序
├── step1_data_processing.py       # 数据提取与整合
├── step2_correlation_analysis.py  # FOS相关性与可视化
├── step3_model_comparison.py      # 多模型性能对比
├── step4_climate_analysis.py      # 气候区影响分析
├── data/                          # 数据目录
│   ├── raw/                       # 原始监测数据(F1-F22文件夹)
│   ├── P1.csv                     # 处理后参数(步骤1输出)
│   ├── P2.csv                     # 含FOV预测(步骤3输出)
│   └── P3.csv                     # 含气候区(步骤4输入)
├── results/                       # 分析输出
│   ├── correlations/              # 步骤2图件
│   ├── models/                    # 步骤3图件
│   └── climate/                   # 步骤4图件
└── README.md                      # 英文文档
```

## 快速开始

### 安装

```bash
pip install pandas numpy matplotlib seaborn scipy scikit-learn rasterio
```

### 运行完整流水线

```bash
python main.py
```

### 运行特定步骤

```bash
python main.py --steps 1 2 3    # 仅运行步骤1-3
python main.py --no-clean        # 跳过清理旧结果
```

## 流水线步骤详解

### 步骤1：数据处理

**输入：** `data/raw/F*/` 文件夹中的CSV文件

**输出：** `data/P1.csv` - 整合后的大坝参数

**特性：**
- 多线程并行处理
- 提取空间数据的最大/最小值
- 与大坝元数据合并
- 质量控制和验证

### 步骤2：相关性分析

**输入：** `data/P1.csv`

**输出图件：**
- `fig2a_key_correlations.png` - 电阻率相关性 (2×2)
- `fig2b_other_correlations.png` - 自然电位与耦合电场 (3×2)
- `fov_analysis_combined.png` - FOS分析 (2×2):
  - (a) 正常vs渗漏FOS
  - (b) FOS变化分布
  - (c) 按气候区的FOS小提琴图
  - (d) 按气候区的FOS瀑布图

### 步骤3：模型对比

**四个模型：**

| 模型 | 特征 | 目标 |
|------|------|------|
| 模型1 | 正常自然电位 | 正常FOS |
| 模型2 | 渗漏自然电位 | 渗漏FOS |
| 模型3 | 耦合电场 | 渗漏FOS |
| 模型4 | 自然电位+耦合电场 | 渗漏FOS |

**算法：** 线性回归、岭回归、Lasso、随机森林、梯度提升、SVR

**输出：**
- `model_scatter_comparison.png` - 2×2模型对比
- `model_combined_scatter.png` - 所有模型叠加
- `data/P2.csv` - 原始数据 + FOV预测

### 步骤4：气候影响分析

**输入：** `data/P3.csv` (P2 + 气候区)

**气候区：** A(热带), B(干旱), C(温带), D(大陆性), E(极地)

**输出：**
- `climate_fos_boxplot.png` - 箱线图
- `climate_fos_violin.png` - 小提琴图
- `climate_stability_stacked.png` - 堆叠柱状图
- 统计检验结果(JSON)

## 配置说明

编辑 `config.py` 可设置：
- 目录路径
- 参数映射
- FOS阈值
- 配色方案
- 绑图设置

## 输出示例

### 相关性矩阵
展示所有监测参数之间的关系。

### 模型比较
展示添加耦合电场信号带来的改进：
- 模型2与模型4的对比
- 各算法在不同模型上的表现
- 最佳模型识别

### 气候分析
展示各气候区的FOS分布和稳定性分类。

## 故障排除

### 常见问题

1. **数据文件缺失**：确保数据文件位于 `data/` 目录
2. **编码错误**：文件应使用UTF-8编码
3. **缺少包**：运行 `pip install -r requirements.txt`

### 调试模式

运行单独脚本并输出详细信息：
```bash
python -u step1_data_processing.py
```

## 工作流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                         原始数据                                 │
│  (电阻率、自然电位、耦合电场、FOS计算结果)                        │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    步骤1：数据处理                               │
│  - 从多源提取参数                                                │
│  - 统一格式和命名                                                │
│  - 生成整合数据集                                                │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    步骤2：相关性分析                             │
│  - 计算皮尔逊相关系数                                            │
│  - 生成散点图和回归线                                            │
│  - 创建相关性矩阵热力图                                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    步骤3：模型比较                               │
│  - 四模型对比实验                                                │
│  - 多算法性能评估                                                │
│  - 证明耦合电场信号价值                                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    步骤4：气候分析                               │
│  - 按气候区统计FOS分布                                           │
│  - 稳定性分类统计                                                │
│  - 显著性检验                                                    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        分析结果                                  │
│  (图表、统计表、模型文件)                                        │
└─────────────────────────────────────────────────────────────────┘
```

## 研究背景

本分析流水线用于支持堤坝安全稳定性评估研究，核心目标是：

1. **验证耦合电场信号的价值**：通过四模型对比，证明添加耦合电场信号可以显著提高FOS预测精度。

2. **建立评估标准**：基于机器学习模型，建立可靠的堤坝稳定性评估标准。

3. **分析气候影响**：研究不同气候区对堤坝稳定性的影响。

## 许可证

MIT许可证

## 联系方式

如有问题或建议，请联系项目维护者。

